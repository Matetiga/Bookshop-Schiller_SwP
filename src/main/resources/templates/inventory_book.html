<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en"
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

    <head>
        <title>Inventory List</title>
        <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
        <link rel="stylesheet" th:href="@{/resources/css/style.css}">
        <link rel="stylesheet" th:href="@{/resources/css/inventory_style.css}">
    </head>
    <body>
        <div sec:authorize="hasRole('ADMIN')">
            <div th:replace="fragments/admin_navbar :: navbar"></div>
        </div>
        <div sec:authorize="hasRole('EMPLOYEE')">
            <div th:replace="fragments/employee_navbar :: navbar"></div>
        </div>
    <header>
        <h1 th:text="#{inventory.title}">Inventory Lists</h1>
    </header>
    <div class="container-large">

        <aside class="sidebar panel-effect">
            <button th:text="#{inventory.backToHome}" class="small-nav-tab-button" th:onclick="|location.href='@{/}'|">Back to Welcome</button>
            <ul class="small-nav">
                <li><button th:text="#{inventory.BookList}" class="small-nav-tab-button active" th:onclick="|location.href='@{/inventory_book}'|">Book List</button></li>
                <li><button th:text="#{inventory.MerchList}" class="small-nav-tab-button" th:onclick="|location.href='@{/inventory_merch}'|">Merch List</button></li>
                <li><button th:text="#{inventory.CalenderList}" class="small-nav-tab-button" th:onclick="|location.href='@{/inventory_calendar}'|">Calendar List</button></li>
            </ul>
            <button id="openForm">Add New Book</button>
        </aside>

        <section class="right-view panel-effect">
            <table class="compact-table">
                <tr>
                    <th th:text="#{inventory.name}">Name</th>
                    <th th:text="#{inventory.stock}">Stock</th>
                    <th th:text="#{inventory.img}">Image</th>
                    <th th:text="#{inventory.price}">Price</th>
                    <th th:text="#{inventory.desc}">Description</th>
                    <th th:text="#{inventory.genre}">Genre</th>
                    <th th:text="#{inventory.author}">Author</th>
                    <th th:text="#{inventory.isbn}">ISBN</th>
                    <th th:text="#{inventory.publisher}">Publisher</th>
                </tr>
                <tr th:each="book : ${books}">
                    <td th:text="${book.getKey().name}"></td>
                    <td th:text="${book.getValue()}"></td>
                    <td th:text="${book.getKey().image}"></td>
                    <td th:text="${book.getKey().price}"></td>
                    <td th:text="${book.getKey().description}"></td>

                    <td>
                        <ul>
                            <li th:each="genre : ${book.getKey().getBookGenres()}">
                                <span th:text="${genre.genre}"></span>
                            </li>
                        </ul>
                    <td th:text="${book.getKey().author}"></td>
                    <td th:text="${book.getKey().ISBN}"></td>
                    <td th:text="${book.getKey().publisher}"></td>
                    <td>
                        <form th:action="@{/inventory/increase}" method="post">
                            <input type="hidden" name="itemId" th:value="${book.getKey().id}" />
                            <input type="hidden" name="viewName" th:value="'inventory_book'" />
                            <button type="submit" >+</button>
                        </form>
                    </td>
                    <td>
                        <form th:action="@{/inventory/decrease}" method="post">
                            <input type="hidden" name="itemId" th:value="${book.getKey().id}" />
                            <button type="submit" >-</button>
                        </form>
                    </td>
                    <td>
                        <form th:action="@{/inventory/delete}" method="post" onsubmit="return confirmDelete()">
                            <input type="hidden" name="itemId" th:value="${book.getKey().id}" />
                            <button type="submit">Delete Item :(</button>
                        </form>
                    </td>
                    <td>
                        <form th:action="@{/inventory/editable}" method="post">
                            <input type="hidden" name="itemId" th:value="${book.getKey().id}" />
                            <button type="submit">EDIT</button>
                        </form>
                    </td>
                </tr>
            </table>

                <h2>Genres List</h2>
                <form th:action="@{/inventory/add_newGenre}" method="post">
                    <label>
                        <input type="text" name="newGenre" placeholder="Enter new Genre"/>
                        <span th:if="${error_newGenre}" th:text="${error_newGenre}"></span>
                    </label>
                    <button type="submit">Create new Genre</button>
                </form>
                <table class="compact-table">
                    <tr>
                        <th th:text="#{inventory.genre}">Genre</th>
                    </tr>
                    <tr th:each="genre : ${bookGenres_addBook}">
                        <td th:text="${genre.genre}"></td>
                        <td>
                            <form th:action="@{/inventory/delete_genre}" method="post" onsubmit="return confirmDelete()">
                                <input type="hidden" name="genre" th:value="${genre.genre}">
                                <button type="submit">Delete Genre</button>
                            </form>
                        </td>
                    </tr>
                </table>


        </section>
    </div>
        <!-- Adding a table to insert new Books-->
        <div id="addNewBook" class="modal">
            <div class="modal-content">
                <span id="close" class="close">&times;</span>
                <h1>Add New Book</h1>
                <form th:action="@{/inventory/add_book}" method="post" th:object="${bookForm}" enctype="multipart/form-data">
                    <label for="name"></label>
                    <input type="text" id="name" name="name" th:field="*{name}" placeholder="Enter Name" required/>
                    <span th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></span>

                    <label for="stock"></label>
                    <input type="number" id="stock"  th:field="*{stock}" name="stock" placeholder="Enter Stock" required/>
                    <span th:if="${#fields.hasErrors('stock')}" th:errors="*{stock}"></span>


                    <label for="image"></label>
<!--                    th:field="*{image}" accept="image/*"-->
                    <input type="file" id="image" accept=".jpg" name="image"  required/>
                    <span th:if="${#fields.hasErrors('image')}" th:errors="*{image}"></span>



                    <label for="price"></label>
                    <input type="number" id="price" name="price" th:field="*{price}" placeholder="Enter Price" required/>
                    <span th:if="${#fields.hasErrors('price')}" th:errors="*{price}"></span>

                    <label for="description"></label>
                    <input type="text" id="description" name="description" th:field="*{description}" placeholder="Enter Description" required/>
                    <span th:if="${#fields.hasErrors('description')}" th:errors="*{description}"></span>


                    <label for="author"></label>
                    <input type="text" id="author" name="author" th:field="*{author}" placeholder="Enter Author" required/>
                    <span th:if="${#fields.hasErrors('author')}" th:errors="*{author}"></span>

<!--                    Selection of Genres-->
                    <label>
                        <select name="genre[]" multiple th:field="*{genre}">
                            <option value="" disabled selected>Select Genre</option>
                            <option th:each="genre : ${bookGenres_addBook}" th:value="${genre.genre}" th:text="${genre.genre}"></option>
                        </select>
                            <span th:if="${#fields.hasErrors('genre')}" th:errors="*{genre}"></span>
                    </label>


                    <label for="ISBN"></label>
                    <input type="text" id="ISBN" name="ISBN" th:field="*{ISBN}" placeholder="Enter ISBN" required/>
                    <span th:if="${#fields.hasErrors('ISBN')}" th:errors="*{ISBN}"></span>


                    <label for="publisher"></label>
                    <input type="text" id="publisher" name="publisher" th:field="*{publisher}" placeholder="Enter Publisher" required/>
                    <span th:if="${#fields.hasErrors('publisher')}" th:errors="*{publisher}"></span>


                    <div class="modal-footer">
                        <button class="add-book_button" type="submit">Add Book</button>
                    </div>
                </form>
            </div>

        </div>

    </body>
    <script th:inline="javascript">
        const modal = document.getElementById('addNewBook');
        const open = document.getElementById('openForm');
        const close = document.getElementById('close');

        open.onclick = function (){
            modal.style.display = 'block';
        }

        close.onclick = function (){
            modal.style.display = 'none';
        }

        document.addEventListener("DOMContentLoaded", function (){
            if(/*[[${showModal}]]*/ '') {
                modal.style.display = 'block';
            }
        });

        function confirmDelete() {
            return confirm("Are you sure you want to delete this?");
        }
    </script>

</html>



